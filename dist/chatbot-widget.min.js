(function(){'use strict';const CONFIG ={apiEndpoint:'https:position:'bottom-right',maxMessages:100,typing:{enabled:true,duration:1500}};const CSS_STYLES = ` .chatbot-widget{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen,Ubuntu,Cantarell,sans-serif;position:fixed;z-index:10000;right:20px;bottom:20px;}.chatbot-button{width:60px;height:60px;border-radius:50%;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);border:none;cursor:pointer;box-shadow:0 4px 20px rgba(102,126,234,0.4);display:flex;align-items:center;justify-content:center;transition:all 0.3s ease;color:white;font-size:24px;}.chatbot-button:hover{transform:scale(1.1);box-shadow:0 6px 25px rgba(102,126,234,0.6);}.chatbot-button.open{background:#ff4757;}.chatbot-window{position:absolute;bottom:80px;right:0;width:350px;height:500px;background:white;border-radius:12px;box-shadow:0 8px 40px rgba(0,0,0,0.15);display:flex;flex-direction:column;opacity:0;visibility:hidden;transform:translateY(20px)scale(0.9);transition:all 0.3s ease;}.chatbot-window.open{opacity:1;visibility:visible;transform:translateY(0)scale(1);}.chatbot-header{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;padding:16px;border-radius:12px 12px 0 0;font-weight:600;font-size:16px;}.chatbot-messages{flex:1;overflow-y:auto;padding:16px;display:flex;flex-direction:column;gap:12px;}.chatbot-messages::-webkit-scrollbar{width:6px;}.chatbot-messages::-webkit-scrollbar-track{background:#f1f1f1;border-radius:3px;}.chatbot-messages::-webkit-scrollbar-thumb{background:#c1c1c1;border-radius:3px;}.chatbot-message{max-width:80%;padding:10px 14px;border-radius:18px;font-size:14px;line-height:1.4;word-wrap:break-word;}.chatbot-message.user{align-self:flex-end;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;border-bottom-right-radius:4px;}.chatbot-message.bot{align-self:flex-start;background:#f1f3f4;color:#333;border-bottom-left-radius:4px;}.chatbot-input-area{padding:16px;border-top:1px solid #e0e0e0;display:flex;gap:8px;align-items:flex-end;}.chatbot-input{flex:1;border:1px solid #e0e0e0;border-radius:20px;padding:10px 16px;font-size:14px;resize:none;outline:none;min-height:20px;max-height:100px;font-family:inherit;}.chatbot-input:focus{border-color:#667eea;box-shadow:0 0 0 2px rgba(102,126,234,0.1);}.chatbot-send-button{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);border:none;border-radius:50%;width:40px;height:40px;display:flex;align-items:center;justify-content:center;cursor:pointer;color:white;font-size:16px;transition:all 0.2s ease;}.chatbot-send-button:hover{transform:scale(1.1);}.chatbot-send-button:disabled{background:#ccc;cursor:not-allowed;transform:none;}.chatbot-typing{align-self:flex-start;background:#f1f3f4;color:#666;font-style:italic;border-bottom-left-radius:4px;}.chatbot-typing::after{content:'';display:inline-block;width:8px;height:8px;margin-left:8px;border-radius:50%;background:#666;animation:chatbot-typing 1.4s infinite ease-in-out;}@keyframes chatbot-typing{0%,80%,100%{opacity:0.3;}40%{opacity:1;}}@media(max-width:480px){.chatbot-widget{right:10px;bottom:10px;}.chatbot-window{width:calc(100vw - 20px);right:-10px;bottom:80px;height:70vh;}}`;class ChatbotWidget{constructor(agentId = null){this.agentId = agentId;this.isOpen = false;this.messages = [];this.isTyping = false;this.init();}init(){this.injectStyles();this.createWidget();this.bindEvents();}injectStyles(){if(document.getElementById('chatbot-widget-styles'))return;const style = document.createElement('style');style.id = 'chatbot-widget-styles';style.textContent = CSS_STYLES;document.head.appendChild(style);}createWidget(){this.widget = document.createElement('div');this.widget.className = 'chatbot-widget';this.widget.innerHTML = ` <div class="chatbot-window"> <div class="chatbot-header"> ðŸ’¬ Chat Assistant </div> <div class="chatbot-messages"></div> <div class="chatbot-input-area"> <textarea class="chatbot-input" placeholder="Type your message..." rows="1"></textarea> <button class="chatbot-send-button">âž¤</button> </div> </div> <button class="chatbot-button">ðŸ’¬</button> `;document.body.appendChild(this.widget);this.button = this.widget.querySelector('.chatbot-button');this.window = this.widget.querySelector('.chatbot-window');this.messages = this.widget.querySelector('.chatbot-messages');this.input = this.widget.querySelector('.chatbot-input');this.sendButton = this.widget.querySelector('.chatbot-send-button');this.input.addEventListener('input',()=>{this.input.style.height = 'auto';this.input.style.height = Math.min(this.input.scrollHeight,100)+ 'px';});}bindEvents(){this.button.addEventListener('click',()=> this.toggleChat());this.sendButton.addEventListener('click',()=> this.sendMessage());this.input.addEventListener('keypress',(e)=>{if(e.key === 'Enter' && !e.shiftKey){e.preventDefault();this.sendMessage();}});document.addEventListener('click',(e)=>{if(!this.widget.contains(e.target)&& this.isOpen){this.closeChat();}});}toggleChat(){if(this.isOpen){this.closeChat();}else{this.openChat();}}openChat(){this.isOpen = true;this.window.classList.add('open');this.button.classList.add('open');this.button.innerHTML = 'âœ•';setTimeout(()=> this.input.focus(),300);if(this.messages.children.length === 0){this.addMessage('bot','Hello! How can I help you today?');}}closeChat(){this.isOpen = false;this.window.classList.remove('open');this.button.classList.remove('open');this.button.innerHTML = 'ðŸ’¬';}async sendMessage(){const message = this.input.value.trim();if(!message || this.isTyping)return;this.addMessage('user',message);this.input.value = '';this.input.style.height = 'auto';this.showTyping();try{const response = await this.callAPI(message);this.hideTyping();this.addMessage('bot',response);}catch(error){this.hideTyping();this.addMessage('bot','Sorry,I encountered an error. Please try again.');console.error('Chatbot API error:',error);}}async callAPI(message){const payload ={message:message};if(this.agentId){payload.agent_id = this.agentId;}const response = await fetch(CONFIG.apiEndpoint,{method:'POST',headers:{'Content-Type':'application/json',},body:JSON.stringify(payload)});if(!response.ok){throw new Error(`HTTP error! status:${response.status}`);}const data = await response.json();return data.response || 'Sorry,I didn\'t understand that.';}addMessage(sender,text){const messageElement = document.createElement('div');messageElement.className = `chatbot-message ${sender}`;messageElement.textContent = text;this.messages.appendChild(messageElement);this.scrollToBottom();while(this.messages.children.length > CONFIG.maxMessages){this.messages.removeChild(this.messages.firstChild);}}showTyping(){if(this.isTyping)return;this.isTyping = true;const typingElement = document.createElement('div');typingElement.className = 'chatbot-message bot chatbot-typing';typingElement.textContent = 'Typing';typingElement.id = 'chatbot-typing-indicator';this.messages.appendChild(typingElement);this.scrollToBottom();}hideTyping(){this.isTyping = false;const typingElement = document.getElementById('chatbot-typing-indicator');if(typingElement){typingElement.remove();}}scrollToBottom(){setTimeout(()=>{this.messages.scrollTop = this.messages.scrollHeight;},100);}}class MyChatbot extends HTMLElement{connectedCallback(){const agentId = this.getAttribute('agent-id');new ChatbotWidget(agentId);}}function initWidget(){if(!customElements.get('my-chatbot')){customElements.define('my-chatbot',MyChatbot);}if(!document.querySelector('my-chatbot')){new ChatbotWidget();}}if(document.readyState === 'loading'){document.addEventListener('DOMContentLoaded',initWidget);}else{initWidget();}})();